@version: 3.0

# syslog-ng.conf - Configuration for Nebula
#
# For a description of syslog-ng configuration file directives, please read
# the syslog-ng Administrator's guide at:
#
# http://www.balabit.com/dl/html/syslog-ng-admin-guide_en.html/bk01-toc.html
#

options {
	long_hostnames (off);
	use_dns (no);
	use_fqdn (no);
	keep_hostname (yes);
	create_dirs (yes);
	owner (root);
	dir_owner (root);
	perm (0640);
	dir_perm (0750);
	stats_freq(43200);
};

# sources

source s_local {
	# message generated by Syslog-NG
	internal();
	# standard Linux log source (this is the default place for the syslog()
	# function to send logs to)
	unix-stream("/dev/log");
	# messages from the kernel
	file("/proc/kmsg" program_override("kernel: "));
};

# Euca Log files
source euca_log {
	file("/var/log/eucalyptus/nc.log" );
};

# filters

filter no_debug {
	level(info..emerg);
};

filter nova {
        level(debug..emerg) and
        program(".*_worker");
};
# destinations

# Euca log destination
destination euca_master { udp("172.24.224.10"); };

destination d_messages { file("/var/log/messages"); };
destination d_nova { file("/var/log/nova"); };

destination d_logserver { tcp("172.24.224.10"); };


# Send Euca logs to Euca log master
log {
	source(euca_log);
	filter(no_debug);
	destination(euca_master);
};

log {
	source(s_local);
	filter(nova);
	destination(d_nova);
};


log {
	source(s_local);
	filter(no_debug);
	destination(d_messages);
	destination(d_logserver);
};

